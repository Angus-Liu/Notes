### 7.1 Linux的安全性

#### 7.1.1 /etc/passwd文件

Linux系统使用一个专门的文件来将用户的登录名匹配到对应的UID值。这个文件就是/etc/passwd文件，它包含了一些与用户有关的信息。

```bash
angus:x:1000:1000::/home/angus:/usr/bin/zsh
```

/etc/passwd文件的字段包含了如下信息：

+ 登录用户名
+ 用户密码
+ 用户账户的UID（数字形式）
+ 用户账户的组ID（GID）（数字形式）
+ 用户账户的文本描述（称为备注字段）
+ 用户HOME目录的位置
+ 用户的默认shell

#### 7.1.2 /etc/shadow文件

/etc/shadow文件对Linux系统密码管理提供了更多的控制。只有root用户才能访问/etc/shadow文件，这让它比起/etc/passwd安全许多。

/etc/shadow文件为系统上的每个用户账户都保存了一条记录。记录就像下面这样：

```bash
angus:$6$ETMz5sH1$qJrRvSpi4xFWrXJ0zH8htTc1f7.BOUZ.Xnm7IFQwnsNyHXF3l42eUf01RoaR/u8xaMdsCL38CTX.tR4S9q.0s.:17606:0:99999:7:::
```

在/etc/shadow文件的每条记录中都有9个字段：

+ 与/etc/passwd文件中的登录名字段对应的登录名
+ 加密后的密码
+ 自上次修改密码后过去的天数密码（自1970年1月1日开始计算）
+ 多少天后才能更改密码
+ 多少天后必须更改密码
+ 密码过期前提前多少天提醒用户更改密码
+ 密码过期后多少天禁用用户账户
+ 用户账户被禁用的日期（用自1970年1月1日到当天的天数表示）
+ 预留字段给将来使用

#### 7.1.3 添加新用户

用来向Linux系统添加新用户的主要工具是useradd 。

#### 7.1.4 删除用户

如果你想从系统中删除用户，userdel 可以满足这个需求。默认情况下，userdel 命令会只删除/etc/passwd文件中的用户信息，而不会删除系统中属于该账户的任何文件。

如果加上-r 参数，userdel 会删除用户的HOME目录以及邮件目录。然而，系统上仍可能存有已删除用户的其他文件。这在有些环境中会造成问题。

#### 7.1.5 修改用户

| 命令       | 描述                                                     |
| ---------- | -------------------------------------------------------- |
| `usermod`  | 修改用户账户的字段，还可以指定主要组以及附加组的所属关系 |
| `passwd`   | 修改已有用户的密码                                       |
| `chpasswd` | 从文件中读取登录名密码对，并更新密码                     |
| `chage`    | 修改密码的过期日期                                       |
| `chfn`     | 修改用户账户的备注信息                                   |
| `chsh`     | 修改用户账户的默认登录shell                              |

 ### 7.2 使用Linux组

#### 7.2.1 /etc/group文件

与用户账户类似，组信息也保存在系统的一个文件中。/etc/group文件包含系统上用到的每个组的信息。下面是一些来自Linux系统上/etc/group文件中的典型例子。

```bash
angus:x:1000:
autologin:x:999:angus
```

/etc/group文件有4个字段：

+ 组名
+ 组密码（允许非组内成员通过它临时成为该组成员）
+ GID
+ 属于该组的用户列表、

#### 7.2.2 创建新组

groupadd 命令可在系统上创建新组。

#### 7.2.3 修改组

在/etc/group文件中可以看到，需要修改的组信息并不多。groupmod 命令可以修改已有组的GID（加-g 选项）或组名（加-n 选项）。

### 7.3 理解文件权限

#### 7.3.1 使用文件权限符

ls 命令可以用来查看Linux系统上的文件、目录和设备的权限。

```bash
➜  ~ ls -l
总用量 52
-rw-r--r-- 1 angus angus     0 6月  15 16:05 a.out
drwxr-xr-x 2 angus angus  4096 4月  22 08:57 Desktop
drwxr-xr-x 7 angus angus  4096 5月  15 14:47 Documents
drwxr-xr-x 2 angus angus  4096 3月  16 10:32 Downloads
-rw-r--r-- 1 angus angus  2821 6月  16 20:47 file1
-rw-r--r-- 1 angus angus 12448 6月  16 20:47 file2
drwxr-xr-x 3 angus angus  4096 3月  16 11:57 Music
drwxr-xr-x 4 angus angus  4096 3月  16 12:44 Pictures
drwxr-xr-x 3 angus angus  4096 6月  15 14:40 TEMP
drwxr-xr-x 2 angus angus  4096 3月  16 10:51 Templates
drwxr-xr-x 2 angus angus  4096 3月  16 10:32 Videos
```

输出结果的第一个字段就是描述文件和目录权限的编码。这个字段的第一个字符代表了对象的类型：

+ 代表文件
+ d 代表目录
+ l 代表链接
+ c 代表字符型设备
+ b 代表块设备
+ n 代表网络设备

之后有3组三字符的编码。每一组定义了3种访问权限：

+ r 代表对象是可读的
+ w 代表对象是可写的
+ x 代表对象是可执行的

若没有某种权限，在该权限位会出现单破折线。这3组权限分别对应对象的3个安全级别：

+ 对象的属主
+ 对象的属组
+ 系统其他用户

#### 7.3.2 默认文件权限

umask 命令用来设置所创建文件和目录的默认权限。

```bash
angus@angus-PC:~$ umask
0022
```

umask 第一位代表了一项特别的安全特性，叫作粘着位 （sticky bit）。后面的3位表示文件或目录对应的 umask 八进制值。

umask 值只是个掩码。它会屏蔽掉不想授予该安全级别的权限。对文件来说，全权限的值是666 （所有用户都有读和写的权限）；而对目录来说，则是777 （所有用户都有读、写、执行权限）。所以在上例中，文件一开始的权限是666 ，减去umask 值022 之后，剩下的文件权限就成了644 。

### 7.4 改变安全性设置

#### 7.4.1 改变权限

chmod 命令用来改变文件和目录的安全性设置。

#### 7.4.2 改变所属关系

chown 命令用来改变文件的属主，chgrp 命令用来改变文件的默认属组。

### 7.5 共享文件

inux还为每个文件和目录存储了3个额外的信息位。

+ 设置用户ID（SUID） ：当文件被用户使用时，程序会以文件属主的权限运行。
+ 设置组ID（SGID） ：对文件来说，程序会以文件属组的权限运行；对目录来说，目录中创建的新文件会以目录的默认属组作为默认属组。
+ 粘着位 ：进程结束后文件还驻留（粘着）在内存中。

SGID位对文件共享非常重要。启用SGID位后，你可以强制在一个共享目录下创建的新文件都属于该目录的属组，这个组也就成为了每个用户的属组。

SGID可通过chmod 命令设置。它会加到标准3位八进制值之前（组成4位八进制值），或者在符号模式下用符号s 。