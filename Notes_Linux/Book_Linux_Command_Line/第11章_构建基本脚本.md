### 11.2 创建 shell 脚本文件

在创建shell脚本文件时，必须在文件的第一行指定要使用的shell。其格式为：

```shell
#!/bin/bash
```

在通常的shell脚本中，井号（# ）用作注释行。shell并不会处理shell脚本中的注释行。然而，shell脚本文件的第一行是个例外，# 后面的惊叹号会告诉shell用哪个shell来运行脚本（是的，你可以使用bash shell，同时还可以使用另一个shell来运行你的脚本）。

在指定了shell之后，就可以在文件的每一行中输入命令，然后加一个回车符。之前提到过，注释可用# 添加。例如：

```shell
#!/bin/bash
# This script displays the date and who's logged on
date
who
```

### 11.4 使用变量

#### 11.4.3 命令替换

shell脚本中最有用的特性之一就是可以从命令输出中提取信息，并将其赋给变量。把输出赋给变量之后，就可以随意在脚本中使用了。这个特性在处理脚本数据时尤为方便。

有两种方法可以将命令输出赋给变量：

+ 反引号字符（` ）
+ $() 格式

```shel
testing=`date`
testing=$(date)
```

### 11.6 管道

我们用不着将命令输出重定向到文件中，可以将其直接重定向到另一个命令。这个过程叫作管道连接 （piping）。

```shell
command1 | command2
```

不要以为由管道串起的两个命令会依次执行。Linux系统实际上会同时运行这两个命令，在系统内部将它们连接起来。在第一个命令产生输出的同时，输出会被立即送给第二个命令。数据传输不会用到任何中间文件或缓冲区。

### 11.7 执行数学运算

#### 11.7.2 使用方括号

bash shell为了保持跟Bourne shell的兼容而包含了expr 命令，但它同样也提供了一种更简单的方法来执行数学表达式。在bash中，在将一个数学运算结果赋给某个变量时，可以用美元符和方括号（$[ operation ] ）将数学表达式围起来。

```shell
$ var1=$[1 + 5]
$ echo $var1
6
$ var2=$[$var1 * 2]
$ echo $var2
12
$
```

#### 11.7.3 浮点解决方案

有几种解决方案能够克服bash中数学运算的整数限制。最常见的方案是用内建的bash计算器，叫作bc 。

scale 变量的默认值是0 。在scale 值被设置前，bash计算器的计算结果不包含小数位。

### 11.8 退出脚本

shell中运行的每个命令都使用退出状态码 （exit status）告诉shell它已经运行完毕。退出状态码是一个0～255的整数值，在命令结束运行时由命令传给shell。可以捕获这个值并在脚本中使用。

#### 11.8.1 查看退出状态码

Linux提供了一个专门的变量\$? 来保存上个已执行命令的退出状态码。对于需要进行检查的命令，必须在其运行完毕后立刻查看或使用$? 变量。它的值会变成由shell所执行的最后一条命令的退出状态码。

**Linux退出状态码**

| 状态码  | 描述                       |
| ------- | -------------------------- |
| `0`     | 命令成功结束               |
| `1`     | 一般性未知错误             |
| `2`     | 不适合的shell命令          |
| `126`   | 命令不可执行               |
| `127`   | 没找到命令                 |
| `128`   | 无效的退出参数             |
| `128+x` | 与Linux信号x相关的严重错误 |
| `130`   | 通过Ctrl+C终止的命令       |
| `255`   | 正常范围之外的退出状态码   |

#### 11.8.2 exit 命令

exit 命令允许你在脚本结束时指定一个退出状态码（0-255之间，大于255会返回除以256之后的余数）。





