## MySQL 命名设计及使用规范

### # 命名规范

- [强制] 库名、表名、字段名必须使用小写字母，下划线风格，不超过32字符，必须见名知意，禁止拼音英文混用

- [强制] 禁止使用 MySQL 保留字（介绍一下MySQL保留字有哪些）

- **库命名规范**

  - [建议] 库名与应用名称尽量一致，下划线分割

- **表命名规范**

  - [强制] 表的命名最好是加上“业务名称_表的作用” 或 者“表名的作用”

    正例：userinfo , iclass_unit

  - [强制] 临时库、表名必须以tmp为前缀，并以日期为后缀

    正例： tmp_test01_20130704

  - [强制] 备份库、表必须以bak为前缀，并以日期为后缀

    正例：bak_test01_20130704
  
- **字段命名规范**

  - [强制] 表必须有四个字段（id，create_time 和 update_time, deleted），便于跟踪数据的变化

- **索引命名规范**

  - [强制] 唯一索引：udx_字段名称_

    正例： udx_phone（uk_）

  - [强制] 普通索引：idx_字段名称

    正例： idx_phone_email

### # 设计规范

- **表设计规范**

  - [强制] 限制单实例表数量在300以内，最多不要超过500个表

  - [强制] 单表字段数不要太多，字段数建议在20以内，最多不要大于50个
  - [强制] 存储引擎使用INNODB存储引擎（与其他引擎的对比）
  - [强制] 数据表、数据字段必须加入中文注释
  - [强制] 禁止使用存储过程、视图、触发器、Event
  - [强制] 禁止存储大文件或者大照片
  - [强制] 表必须有主键，例如自增主键
  - [强制] 禁止使用外键，如果有外键完整性约束，需要应用程序控制
- **字段设计规范**

  - [强制] 强烈建议使用TINYINT来代替ENUM类型
  - [强制] 避免使用NULL字段，建议用 0、空串、当前时间或特殊值代替 NULL 值
  - [强制] 禁止使用TEXT、BLOB类型
  - [强制] 字段允许适当冗余，以提高性能，但是必须考虑数据同步的情况
  - [强制] 小数类型为 decimal，禁止使用 float 和 double
  - [强制] 如果存储的字符串长度几乎相等，使用 char 定长字符串类型  
  - [建议] 建议使用 UNSIGNED 存储非负数值
  - [建议] 合适的字符存储长度，不但节约数据表空间、节约索引存储，更重要的是提升检索速度
  - [建议] 避免使用联合主键
- **索引设计规范**

  - [建议] 单表索引建议控制在5个以内
- [建议] 单索引字段数不允许超过5个
  - [强制] 禁止在更新十分频繁、区分度不高的属性上建立索引
- [强制] 建立组合索引，必须把区分度高的字段放在前面
  - [强制] 在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据 实际文本区分度决定索引长度
- [强制] 有order by的场景，请注意利用索引的有序性。order by最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能
  - [强制]利用延迟关联或者子查询优化超多分页场景 
- [强制] SQL性能优化的目标:至少要达到 range 级别，要求是 ref 级别，如果可以是 consts 最好。  
  
  - 1) consts 单表中最多只有一个匹配行(主键或者唯一索引)，在优化阶段即可读取到数据
    - 2) ref 指的是使用普通的索引(normal index)
  - 3) range 对索引进行范围检索
  - [强制] 禁止重复索引
- **字符集规范**
  - [建议] 数据库使用默认编码`utf8mb4`

### # 使用规范

- [强制] 禁止使用`SELECT *`,只获取必要的字段，需要显示说明列属性
- [强制] 禁止使用INSERT INTO t_xxx VALUES(xxx)，必须显示指定插入的列属性
- [强制] 减少与数据库交互次数，尽量采用批量SQL语句
- [强制] 禁止使用属性隐式转换
- [建议] 用 UNION 代替 OR
- [强制] 禁止在WHERE条件的属性上使用函数或者表达式
- [强制] 禁止负向查询，以及%开头的模糊查询
- [强制] 禁止大表使用JOIN查询，禁止大表使用子查询
- [强制] SQL 语句中 `IN` 包含的值不应过多，控制在 200 个以内，最多不得超过300
- [强制] 获取大量数据时，建议分批次获取数据，每次获取数据少于2000条，结果集应小于1M
- [强制] 避免使用大事务,sql语句尽可能简单
- [建议] 合理控制单表数据量
- [建议] 合理分离冷热数据

### # 数据库初始化

- [强制]数据初始化禁止DROP

