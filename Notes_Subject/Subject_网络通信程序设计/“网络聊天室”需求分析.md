### 功能需求分析 

> #### 客户端

+ 用户注册登录模块
  + 获取新用户信息，校验通过后发送给服务端
  + 已注册用户通过登录验证，进入系统
+ 用户信息修改模块
  + 用户基本信息修改
  + 用户密码修改
+ 好友管理模块
  + 通过用户名添加好友
  + 管理好友（删除，备注等）
  + 查看好友信息
+ 私聊模块
  + 与指定好友进行聊天
  + 接收好友消息

+ 群聊模块

  + 实时显示加入用户或退出用户
  + 发送群聊消息
  + 显示群聊消息

+ 登录状态管理模块

  + 通过心跳机制，向服务端报告客户端状态

> #### 服务端

+ 用户管理模块

  + 用户注册/登录验证

  + 查看用户信息
  + 修改用户部分信息

+ 在线信息模块
  + 实时查看用户在线状况
  + 根据客户端发送过来的心跳消息，管理在线用户

+ 环境配置模块
  + 配置服务器端口信息
  + 配置服务器数据库信息

### 通信协议分析

协议选型：json数据传输协议

> #### 客户端

+ 用户登录

  ```
  {
      "code":100,
      "msg":"xxx",
      "user":{
          "name":"xxx",
          "password":"xxx"
          ...
      }
  }
  ```

+ 用户登出

  ```
  {
      "code":101,
      "msg":"xxx",
      "token":"xxxxxxxxxxxxxxxxxxx"
  }
  ```

+ 用户注册

  ```
  {
      "code":102,
      "user":{
          "name":"xxx",
          "password":"xxx",
          "email":"xxx@xx.com"
          ...
      }
  }
  ```

+ 查询用户

  ```
  {
      "code":103,
      "user":{
          "name":"xxx",
          "email":"xxx@xx.com"
          ...
      }
  }
  ```

+ 添加好友

  ```
  {
      "code":104,
      ""
  }
  ```

+ 发送消息

  ```
  {
      "code":100,
      "sender_name":"xxx",
      "receiver_name":"xxx",
      "type":"text",
      "data":"xxx"
  }
  ```

+ 接收消息

  ```
  
  ```

+ 加入/退出群聊

  ```
  
  ```

+ 心跳消息

  ```
  
  ```

> #### 服务端

  + 登录应答

    ```
    {
        "code":200,
        "msg":"xxx",
        "result":true,
        "token":"xxxxxxxxxxxxxxxxxxx"
    }
    ```

  + 登出应答

    ```
    {
        "code":201,
        "msg":"xxx",
        "result":true
    }
    ```

  + 消息发送应答

    ```
    {
        "code":202,
        "msg":"xxx",
        "result":
    }
    ```

  + 用户查询信息应答

    ```
    {
        "code":202,
        "msg":"xxx",
        "result":true,
        "user":{
            "name":"xxx",
            "email":"xxx@xx.com",
            "state":true,
            ...
        }
    }
    ```

  + 心跳应答

    ```
    {
        "code":203,
        "users":[
            {
                "name":"xxx",
                "state":true
            },
            {
                "name":"xxx",
                "state":false
            },
            ...
        ]
    }
    ```


### 开发平台

+ 语言：Java
+ UI：JavaFX
+ 网络框架：Netty（一款高并发网络框架，待选）
+ 数据库：MySQL
+ 缓存：Redis（待选）



> ## 草稿箱
>
> + 看有没有可能加入语音通话、视频通话



## 服务器端设计

> + 图形界面不与服务器的启动关闭绑定，也就是图形界面上可以打开或关闭服务器
> + 包回应采用简单工厂或是策略设计模式 RequestProcessor or RequestHandler
> + 采用NIO 多线程  线程池 有时间看下Java 8的CompletableFuture
> + 基于Redis实现用户在线列表，或者简单点就用Hashmap
> + 群消息采用复制缓冲区？猜测
> + 即时语音可以将Channel转换为Stream
> + 即时语音要搞成P2P可能好点，就是这样，客户端也得具备服务端功能了，感觉暂时先不考虑这个功能了。耦合性也不大，后期可以加 



## 客户端设计

> - 采用NIO 多线程（这样各个功能之间互不干扰）
> - 聊天记录可以考虑存到本地文件中，以json的格式，方便查取（漫游功能再说）

## 其他设计

> - 日志采用log4j
> - 聊天记录可以考虑存到本地文件中，以json的格式，方便查取（漫游功能再说）



> Message（消息实体）
>
> + Sender（发送方）
> + Receiver（接收方）
> + Date（时间）
> + Data（数据）
> + Attachment（附件）